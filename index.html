<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TwiteBoard - Your X Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        body{font-family:'Roboto',-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;background-color:#000;color:#e7e9ea;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;padding:15px;-webkit-font-smoothing:antialiased}
        .container{background-color:#16181c;padding:2rem;border-radius:16px;border:1px solid #2f3336;text-align:center;width:100%;max-width:500px;box-shadow:0 8px 24px rgba(0,0,0,.5)}
        h1{color:#e7e9ea;font-size:1.8rem;margin-bottom:.5rem}
        p{color:#71767b;margin-bottom:1.5rem}
        .hidden{display:none}
        #login-btn,#logout-btn{background-color:#1d9bf0;color:#fff;border:none;padding:12px 24px;border-radius:99px;font-size:1rem;font-weight:700;cursor:pointer;transition:background-color .2s;display:inline-flex;align-items:center;gap:10px}
        #login-btn:hover{background-color:#1a8cd8}
        .x-logo{width:20px;height:20px}
        .profile-section{display:flex;flex-direction:column;align-items:center;margin-bottom:2rem}
        #profile-pic{width:80px;height:80px;border-radius:50%;border:3px solid #1d9bf0;margin-bottom:1rem;background-color:#202327}
        #profile-name{font-size:1.5rem;font-weight:700;margin:0;color:#e7e9ea}
        #profile-username{font-size:1rem;color:#71767b;margin:.25rem 0 0 0}
        .stats-grid{display:grid;grid-template-columns:1fr;gap:1rem;text-align:left}
        .stat-card{background-color:#202327;padding:1.5rem;border-radius:12px;border:1px solid #2f3336}
        .stat-card h3{margin:0 0 .5rem 0;font-size:1rem;color:#71767b;font-weight:400}
        .stat-card p{margin:0;font-size:2.5rem;font-weight:700;color:#e7e9ea}
        #logout-btn{margin-top:2rem;background-color:rgba(224,36,94,.1);color:#e0245e;border:1px solid #e0245e}
        #loading-message{font-weight:700;color:#1d9bf0;padding:2rem 0}
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="login-container"><h1>TwiteBoard</h1><p>Apni daily X/Twitter activity track karne ke liye login karein.</p><button id="login-btn"><svg viewBox="0 0 24 24" class="x-logo"><g><path fill="white" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></g></svg>Connect with X</button></div>
        <!-- Dashboard Screen -->
        <div id="dashboard" class="hidden"><h1>TwiteBoard</h1><div id="loading-message"><p>Aapka data laya ja raha hai...</p></div><div id="dashboard-content" class="hidden"><div class="profile-section"><img id="profile-pic" alt="Profile Picture"><h2 id="profile-name"></h2><p id="profile-username"></p></div><div class="stats-grid"><div class="stat-card"><h3>Total Posts Today</h3><p id="tweet-count"></p></div><div class="stat-card"><h3>Total Replies Today</h3><p id="reply-count"></p></div><div class="stat-card"><h3>Total Followers</h3><p id="follower-count"></p></div></div></div><button id="logout-btn">Logout</button></div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAVuS0B79Uk24GmPnbj3Tq7M3sgZeWdmA4",
            authDomain: "twiteboard.firebaseapp.com",
            projectId: "twiteboard",
            storageBucket: "twiteboard.appspot.com",
            messagingSenderId: "1029239475877",
            appId: "1:1029239475877:web:7a2eefb61a2a0566ba874c",
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const twitterProvider = new firebase.auth.TwitterAuthProvider();

        const ui = {
            login: document.getElementById('login-container'),
            dashboard: document.getElementById('dashboard'),
            loginBtn: document.getElementById('login-btn'),
            logoutBtn: document.getElementById('logout-btn'),
            loader: document.getElementById('loading-message'),
            content: document.getElementById('dashboard-content'),
            pic: document.getElementById('profile-pic'),
            name: document.getElementById('profile-name'),
            username: document.getElementById('profile-username'),
            tweets: document.getElementById('tweet-count'),
            replies: document.getElementById('reply-count'),
            followers: document.getElementById('follower-count'),
        };

        ui.loginBtn.addEventListener('click', () => {
            // Humara naya plan: Jaise hi login safal ho, usi waqt data maang lo
            auth.signInWithPopup(twitterProvider)
                .then((result) => {
                    // Login safal hua! Ab humare paas VIP Pass (credential) hai
                    const credential = result.credential;
                    // Foran bouncer ko VIP pass dekar data maango
                    fetchDataFromBouncer(credential);
                })
                .catch(handleError);
        });

        ui.logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        auth.onAuthStateChanged(user => {
            // Ye function ab sirf UI dikhane ka kaam karega
            if (user) {
                ui.login.classList.add('hidden');
                ui.dashboard.classList.remove('hidden');
                // Abhi data nahi dikhayenge, sirf loading message
                ui.content.classList.add('hidden');
                ui.loader.classList.remove('hidden');
                ui.loader.innerText = "Data laya ja raha hai...";
                ui.loader.style.color = '#1d9bf0';

            } else {
                ui.dashboard.classList.add('hidden');
                ui.login.classList.remove('hidden');
            }
        });

        async function fetchDataFromBouncer(credential) {
            try {
                // Maine tumhara Render.com wala URL yahan daal diya hai
                const bouncerUrl = "https://twiteboard-bouncer.onrender.com/get-stats";

                const response = await fetch(bouncerUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_token: credential.accessToken,
                        user_secret: credential.secret
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "Bouncer se jawab theek nahi aaya.");
                }

                const data = await response.json();
                updateUI(data);

            } catch (error) {
                handleError(error);
            }
        }

        function updateUI(data) {
            ui.pic.src = data.profile.profile_image_url.replace('_normal', '_400x400');
            ui.name.innerText = data.profile.name;
            ui.username.innerText = `@${data.profile.username}`;
            ui.tweets.innerText = data.stats.tweetsToday;
            ui.replies.innerText = data.stats.repliesToday;
            ui.followers.innerText = data.stats.followersCount;
            
            ui.loader.classList.add('hidden');
            ui.content.classList.remove('hidden');
        }

        function handleError(error) {
            console.error("Ek galti hui hai:", error);
            // Agar user popup band kar de to error na dikhaye
            if (error.code === 'auth/popup-closed-by-user') return;
            ui.loader.innerText = `Error: ${error.message}`;
            ui.loader.style.color = 'red';
            ui.content.classList.add('hidden');
            ui.loader.classList.remove('hidden');
        }
    </script>
</body>
</html>
